# VideoAnalysis
## 环境
Python 3.6.6  
Opencv + contrib 3.4.2.17  
Numpy 1.15.0  
## 功能说明
该项目用于检测成都铁路局运转室监控摄像头下的值班员是否发生睡觉或者离岗问题。
## 输入
输入可以是视频文件，直播流等。除此之外仍然需要的信息有：

1. 当前运转时岗位位置
2. 同一时间影像中需要监督的值班员数量
3. 视频开始分析的时间戳
4. 打盹时长
5. 图片存储目录

### 输入格式
视频文件/流： 字符串，文件或流地址  
值班员数量： 整型  
打盹时长： 整型，单位是秒  
开始时间戳：list , `[年, 月, 日, 时, 分, 秒]`  
图片存储目录： 字符串  
岗位位置： list，内容为tuple，tuple数量应与值班员数量保持一致，tuple包含图片的x, y, w, h 属性。 如：  
`[(x1, y1, w1, h1), (x2, y2, w2, h2)]`  

## 输出
睡觉采用文本记录睡觉时间段的方式，离岗采用关键帧抽取，形成故事快照，再人工复核的方式排查。  
在目标目录下，对于单一岗位疑似睡觉的检测结果存储为txt文件，结果为一个list，list元素是一个存放起止分钟数的tuple， 如：  
`[(8, 13), (20, 43)]`   
即当前视频的8-13分钟，20-43分钟发生疑似睡觉问题，共两处。
对于单一岗位的离岗快照，存在指定目录的一个文件夹中。

## 文件结构
`deploy_tool.py`文件用于手工框定应检区域，并在控制台输出相应的list。调用该函数，也可获得相应list作为返回值。
`elite.py` 文件以多线程方式组织“离岗”， “睡觉”两个函数，对于同一运转室而言，一个人一个项点为一条线程，涵盖所有输入
`funct.py` 文件整合并存放了一些小型算法模块，以备调用
`sleep.py`与`leave.py`存放“睡觉”与“离岗”两大函数
`making_test_list.py` 用于遍历路局第二次提供的视频，生成相应的数据格式，便于测试。`Data_Format.md`则是对该数据格式的说明